# esphome-caisson-controller
Контроллер управления скважинным насосом и мониторингом состояния водопровода и оборудования в скважинном кессоне, построенный на базе микроконтроллера ESP32 (плата [ESP32_Devkitc_V4](https://docs.espressif.com/projects/esp-idf/en/stable/esp32/hw-reference/esp32/get-started-devkitc.html)) и платформы [ESPHome](https://esphome.io/) с возможностью как автономной работы, так и с управлением из [Home Assistant](https://www.home-assistant.io/)

Серия статей о разработке и изготовлении контроллера на Дзен: [Киберскважина](https://dzen.ru/suite/b5294941-1b9c-4668-a064-b185df35a200)

## Цель проекта
Комплексная замена промышленным элементам автоматизации управления скважинным насосом и контроля различных параметров водозаборного узла на земельном участке (реле давления, реле сухого хода, датчики расхода, утечки, температуры и т.п.) Расширенный функционал контроля аварийных ситуаций, наглядный мониторинг параметров работы водозаборного узла, ведение статистики потребления воды.

## Состав системы
- Самодельный контроллер на базе отладочной платы ESP32_Devkitc_V4, выполненный в виде модуля на DIN-рейку.
- AC-DC преобразователь 220В-12В HDR-30-12 MEAN WELL.
- DC-DC преобразователь 12В-3.3В SCWN06A-03 MEAN WELL.
- Твёрдотельные реле G3MB-202P OMRON (4 шт).
- Датчики давления воды XDB305 с токовым выходом 4-20 мА и резьбой на 1/4" (3 шт).
- Датчики расхода воды ZENNER ETKD-I (счётчики воды) с импульсным выходом и резьбой на 3/4" (2 шт).
- Температурные датчики DS18B20 (4 шт).
- Датчик затопления кессона - поплавковый выключатель (лягушка).
- Контактор модульный с ручным управлением КМ20-11МР AC KARAT IEK (4 шт).
- Выключатель нагрузки (мини-рубильник) ВН-32 1Р 20А IEK (3 шт).
- Выключатель-разъединитель трехпозиционный ВРТ-63 1P 16А IEK.
- Выключатель нагрузки (мини-рубильник) ВН-32 2Р 125А IEK.
- Розетка РАр10-3-ОПс заземлением на DIN-рейку IEK.
- Электрощиток IEK TITAN 5 IP 65 на 24 модуля.
- Сигнальные лампы на корпус электрощитка (3 шт).
- Скважинный насос Belamos TF3-60.
- Электроконвектор отопления кессона.
- Светильники для освещения кессона.
- Реле давления Unipump Акваробот Турбипресс в качестве резервной системы автоматики.
- Клавишный выключатель ручного включения насоса.

## Гидравлическая схема системы
![Hydraulic_diagram](https://github.com/false-coder/esphome-caisson-controller/blob/main/device-manufacturing/Hydraulic_diagram.png)

## Функционал
- Измерение давления воды с точностью 0.1 бар в трёх точках обвязки скважины: до фильтра, после фильтра и после редуктора давления на выходе на потребители.
- Измерение расхода воды с точностью 1 литр в двух точках обвязки скважины: до гидроаккумулятора и после него.
- Измерение температуры воздуха с точностью 0.1°C в кессоне на четырёх разных уровнях по высоте.
- Управление работой насоса по установленным порогам давления.
- Переключение управления насосом на резервную систему автоматики (реле давления Unipump).
- Переключение управления насосом в ручной режим для прокачки скважины, промывки системы или для аварийного получения воды из скважины.
- Управление электроотоплением в кессоне при риске замерзания воды.
- Уведомление о необходимости смены фильтрующего элемента в фильтре.
- Информирование о текущем запасе воды в гидроаккумуляторе и изменении его полезного объёма (контроль засорения).
- Отключение насоса в случае следующих аварийных ситуаций:
    - затопление кессона,
    - неисправность / сухой ход насоса,
    - утечка воды до гидроаккумулятора (в кессоне),
    - утечка воды после гидроаккумулятора (на потребителях),
    - засорение фильтра,
    - неисправность реле насоса.
- Отслеживание частоты и продолжительности включения насоса.
- Автономная работа (без интернета, WiFi и облачных сервисов).
- Связь по WiFi с Home Assistant для предоставления интерфейса настроек, управления, контроля параметров и отображения статистики.

## Принципиальная схема системы
![Сircuit_diagram](https://github.com/false-coder/esphome-caisson-controller/blob/main/device-manufacturing/circuit_diagram.png)
